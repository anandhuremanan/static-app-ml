<!DOCTYPE html>
<html>
  <head>
    <title>MLOps Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-gray-100 p-10">
    <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">
      ðŸ“Š MLOps Prediction Dashboard
    </h1>

    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-6">
      <canvas id="predictionChart" height="100"></canvas>
    </div>

    <script>
      // Safely read Flask variable (converted to JSON)
      const rawData = JSON.parse('{{ data | tojson | safe }}');
      const classMap = ["Setosa", "Versicolor", "Virginica"];

      // Prepare data for the chart
      const labels = rawData.map(row => row.timestamp);
      const preds = rawData.map(row => classMap[row.prediction] || "Unknown");

      // Create the chart
      new Chart(document.getElementById("predictionChart"), {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Recent Predictions",
              data: preds.map((p, i) => rawData[i].prediction),
              borderColor: "rgb(79,70,229)",
              borderWidth: 2,
              fill: false,
              tension: 0.2,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
            tooltip: {
              callbacks: {
                label: function (context) {
                  const index = context.dataIndex;
                  return "Prediction: " + preds[index];
                },
              },
            },
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: "Predicted Class (0â€“2)" },
              ticks: {
                callback: function (value) {
                  return classMap[value] || value;
                },
                stepSize: 1,
              },
            },
            x: {
              title: { display: true, text: "Timestamp" },
            },
          },
        },
      });
    </script>
  </body>
</html>
